    <!DOCTYPE html>
    <html lang="en" class="scroll-smooth">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dashboard - SKYNET Automation</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
        <script src="https://unpkg.com/lucide-icons@latest/dist/umd/lucide.js"></script>
        <style>
            body { 
                font-family: 'Inter', sans-serif; 
                background-color: #000000; 
                color: #F3F4F6; 
                overflow-x: hidden; 
            }
            .gradient-text { 
                background: linear-gradient(90deg, #38bdf8, #a78bfa, #f472b6); 
                -webkit-background-clip: text; 
                -webkit-text-fill-color: transparent; 
                background-clip: text; 
                text-fill-color: transparent; 
            }
            .dashboard-card { 
                background-color: rgba(31, 41, 55, 0.3); 
                border: 1px solid rgba(75, 85, 99, 0.5); 
                backdrop-filter: blur(10px); 
                -webkit-backdrop-filter: blur(10px); 
                border-radius: 1rem; 
            }
            .form-textarea { 
                background-color: rgba(31, 41, 55, 0.5); 
                border: 1px solid #4b5563; 
                transition: border-color 0.2s; 
            }
            .form-textarea:focus { 
                border-color: #38bdf8; 
                outline: none; 
                box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.4); 
            }
            .spinner { 
                border: 4px solid rgba(255, 255, 255, 0.3); 
                border-radius: 50%; 
                border-top-color: #38bdf8; 
                width: 24px; 
                height: 24px; 
                animation: spin 1s ease-in-out infinite; 
            }
            @keyframes spin { 
                to { transform: rotate(360deg); } 
            }

            /* New styles for feature buttons/cards */
            .feature-button-card {
                @apply bg-indigo-700 text-white rounded-xl p-8 flex flex-col items-center justify-center text-center cursor-pointer transition-all duration-300 relative overflow-hidden;
                min-height: 220px; /* Increased height for larger buttons with images */
                box-shadow: 0 5px 15px rgba(0,0,0,0.4); 
            }
            .feature-button-card:hover {
                @apply transform scale-102; 
                box-shadow: 0 8px 25px rgba(56, 189, 248, 0.6); 
                background-image: linear-gradient(45deg, #38bdf8, #a78bfa); 
            }
            .feature-button-card img {
                @apply w-24 h-24 mb-4 object-contain; /* Adjust image size */
            }
            .feature-button-card h3 {
                @apply text-3xl font-extrabold mb-2; /* Larger, bolder heading */
            }
            .feature-button-card p {
                @apply text-gray-200 text-base; 
            }

            /* Modal Styles */
            .modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s ease, visibility 0.3s ease;
            }
            .modal.show {
                opacity: 1;
                visibility: visible;
            }
            .modal-content {
                background-color: rgba(31, 41, 55, 0.9); /* Darker glass-morphism */
                border: 1px solid #4b5563;
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
                padding: 2.5rem;
                border-radius: 1.5rem;
                width: 90%;
                max-width: 600px;
                box-shadow: 0 10px 30px rgba(56, 189, 248, 0.3);
                transform: translateY(-20px);
                transition: transform 0.3s ease;
            }
            .modal.show .modal-content {
                transform: translateY(0);
            }
            .modal-header {
                @apply flex justify-between items-center mb-6;
            }
            .modal-header h2 {
                @apply text-3xl font-bold gradient-text;
            }
            .modal-close-btn {
                @apply text-gray-400 hover:text-white text-3xl font-bold;
            }
        </style>
    </head>
    <body class="antialiased">

        <!-- === HEADER === -->
        <header class="sticky top-0 z-50 bg-black/80 backdrop-blur-sm border-b border-gray-800">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="text-2xl font-bold tracking-wider"><a href="index.html">SKYNET</a></div>
                    <nav class="hidden md:flex items-center space-x-8">
                        <a href="services.html" class="hover:text-sky-400 transition-colors">Services</a>
                        <a href="process.html" class="hover:text-sky-400 transition-colors">Our Process</a>
                        <a href="contact.html" class="hover:text-sky-400 transition-colors">Contact</a>
                    </nav>
                    <div class="flex items-center space-x-4">
                        <a href="#" id="sign-out-btn" class="text-sm hover:text-red-400 transition-colors">Sign Out</a>
                    </div>
                </div>
            </div>
        </header>

        <main class="py-20">
            <div class="container mx-auto px-6">
                <h1 class="text-4xl md:text-5xl font-bold mb-12">Automation <span class="gradient-text">Dashboard</span></h1>

                <!-- Instagram Automation Card -->
                <div class="dashboard-card max-w-4xl mx-auto rounded-2xl p-8">
                    <div class="flex items-center gap-4 mb-6">
                        <i data-lucide="instagram" class="w-8 h-8 text-pink-400"></i>
                        <h2 class="text-3xl font-bold">Instagram Automation Hub</h2>
                    </div>

                    <!-- STEP 1: User sees this first. They need to connect their account. -->
                    <div id="insta-disconnected">
                        <p class="text-gray-400 mb-6">To get started, connect your Instagram account. This will redirect you to Instagram to securely authorize SKYNET to post on your behalf.</p>
                        <button id="connect-insta-btn" class="w-full flex items-center justify-center gap-3 py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-gradient-to-r from-pink-500 to-orange-500 hover:opacity-90 transition-opacity">
                            <i data-lucide="link"></i>
                            Connect with Instagram
                        </button>
                    </div>

                    <!-- STEP 2: This section is hidden until the user successfully connects their account. -->
                    <div id="insta-connected" class="hidden">
                        <div class="bg-emerald-900/50 border border-emerald-500 text-emerald-300 px-4 py-3 rounded-lg mb-6 flex items-center gap-3">
                            <i data-lucide="check-circle"></i>
                            <span>Instagram Account Connected: <strong id="insta-username"></strong></span>
                        </div>

                        <!-- Instagram Profile Info -->
                        <div class="grid grid-cols-3 gap-4 text-center mb-8">
                            <div class="p-4 dashboard-card">
                                <p class="text-2xl font-bold text-sky-400" id="insta-posts-count">0</p>
                                <p class="text-gray-400 text-sm">Posts</p>
                            </div>
                            <div class="p-4 dashboard-card">
                                <p class="text-2xl font-bold text-purple-400" id="insta-followers-count">0</p>
                                <p class="text-gray-400 text-sm">Followers</p>
                            </div>
                            <div class="p-4 dashboard-card">
                                <p class="text-2xl font-bold text-pink-400" id="insta-following-count">0</p>
                                <p class="text-gray-400 text-sm">Following</p>
                            </div>
                        </div>

                        <p class="text-gray-400 text-center mb-6">Select an automation feature below.</p>

                        <!-- Instagram Automation Features - Larger, single-color buttons with images -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div class="feature-button-card" data-feature="post">
                                <img src="assets/icons/post-upload.png" alt="Post Upload Icon">
                                <h3>Automated Post Generation</h3>
                                <p>Leverage AI to craft and publish compelling image/video content.</p>
                            </div>
                            <div class="feature-button-card" data-feature="reel">
                                <img src="assets/icons/reel-upload.png" alt="Reel Upload Icon">
                                <h3>Dynamic Reel Creation</h3>
                                <p>Produce captivating short video reels with intelligent content.</p>
                            </div>
                            <div class="feature-button-card" data-feature="chat">
                                <img src="assets/icons/chat-replier.png" alt="Chat Replier Icon">
                                <h3>Intelligent Chat Response</h3>
                                <p>Automate personalized and timely replies to direct messages and comments.</p>
                            </div>
                            <div class="feature-button-card" data-feature="story">
                                <img src="assets/icons/story-creator.png" alt="Story Creator Icon">
                                <h3>Engaging Story Automation</h3>
                                <p>Design and schedule interactive stories to boost audience engagement.</p>
                            </div>
                             <div class="feature-button-card" data-feature="insights">
                                <img src="assets/icons/insights-reporter.png" alt="Insights Reporter Icon">
                                <h3>Comprehensive Insights Reporting</h3>
                                <p>Receive detailed, automated reports on your Instagram performance metrics.</p>
                            </div>
                        </div>
                        
                        <div id="status-message" class="mt-6 text-center text-lg"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Intent Modal/Pop-up -->
        <div id="intent-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-title"></h2>
                    <button id="modal-close-btn" class="modal-close-btn">&times;</button>
                </div>
                <p id="modal-instructions" class="text-gray-300 mb-6"></p>
                <form id="modal-intent-form">
                    <textarea id="modal-intent-textarea" name="intent" rows="7" class="form-textarea w-full rounded-md p-3 text-lg" placeholder=""></textarea>
                    <input type="hidden" id="modal-automation-type" name="automationType">
                    <div class="mt-6">
                        <button type="submit" class="w-full flex items-center justify-center gap-3 py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-sky-500 hover:bg-sky-600 transition-colors">
                            <span id="modal-button-text">Initiate Automation</span>
                            <div id="modal-loading-spinner" class="spinner hidden"></div>
                        </button>
                    </div>
                    <div id="modal-status-message" class="mt-4 text-center text-base"></div>
                </form>
            </div>
        </div>


        <script>
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // --- UI Elements ---
            const disconnectedView = document.getElementById('insta-disconnected');
            const connectedView = document.getElementById('insta-connected');
            const connectButton = document.getElementById('connect-insta-btn');
            const statusMessage = document.getElementById('status-message');
            const instaUsernameSpan = document.getElementById('insta-username');
            const signOutButton = document.getElementById('sign-out-btn');

            // Elements for Instagram profile info
            const instaPostsCount = document.getElementById('insta-posts-count');
            const instaFollowersCount = document.getElementById('insta-followers-count');
            const instaFollowingCount = document.getElementById('insta-following-count');

            // Elements for feature buttons
            const featureButtons = document.querySelectorAll('.feature-button-card');

            // Modal Elements
            const intentModal = document.getElementById('intent-modal');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const modalTitle = document.getElementById('modal-title');
            const modalInstructions = document.getElementById('modal-instructions');
            const modalIntentTextarea = document.getElementById('modal-intent-textarea');
            const modalAutomationTypeInput = document.getElementById('modal-automation-type');
            const modalIntentForm = document.getElementById('modal-intent-form');
            const modalButtonText = document.getElementById('modal-button-text');
            const modalSpinner = document.getElementById('modal-loading-spinner');
            const modalStatusMessage = document.getElementById('modal-status-message');


            // --- Function to update UI based on connection status ---
            function updateInstagramUI(isConnected, username = '', posts = 0, followers = 0, following = 0) {
                if (isConnected) {
                    disconnectedView.classList.add('hidden');
                    connectedView.classList.remove('hidden');
                    instaUsernameSpan.textContent = `@${username}`;
                    instaPostsCount.textContent = posts.toLocaleString();
                    instaFollowersCount.textContent = followers.toLocaleString();
                    instaFollowingCount.textContent = following.toLocaleString();
                } else {
                    disconnectedView.classList.remove('hidden');
                    connectedView.classList.add('hidden');
                    instaUsernameSpan.textContent = '';
                    instaPostsCount.textContent = '0';
                    instaFollowersCount.textContent = '0';
                    instaFollowingCount.textContent = '0';
                }
            }

            // --- Check URL parameters on page load ---
            const urlParams = new URLSearchParams(window.location.search);
            const authStatus = urlParams.get('status');
            const authCode = urlParams.get('code');
            const authErrorMessage = urlParams.get('message');

            let isUserConnected = sessionStorage.getItem('instagramConnected') === 'true';
            // Placeholder data for testing. In a real app, this would come from your backend.
            let connectedUsername = sessionStorage.getItem('instagramUsername') || 'bolzy99'; 
            let userPosts = parseInt(sessionStorage.getItem('instagramPosts') || '120');
            let userFollowers = parseInt(sessionStorage.getItem('instagramFollowers') || '5432');
            let userFollowing = parseInt(sessionStorage.getItem('instagramFollowing') || '87');


            if (authStatus === 'success' && authCode) {
                // User just successfully authorized via Meta
                isUserConnected = true;
                // In a real app, you'd fetch the actual username and metrics from your backend after token exchange
                // For now, we'll use a placeholder or the test username/metrics
                connectedUsername = 'bolzy99'; 
                userPosts = 125;
                userFollowers = 5500;
                userFollowing = 90;

                sessionStorage.setItem('instagramConnected', 'true');
                sessionStorage.setItem('instagramUsername', connectedUsername);
                sessionStorage.setItem('instagramPosts', userPosts);
                sessionStorage.setItem('instagramFollowers', userFollowers);
                sessionStorage.setItem('instagramFollowing', userFollowing);

                statusMessage.textContent = 'Instagram connected successfully!';
                statusMessage.classList.add('text-emerald-400');
                // Clear the URL parameters to prevent re-processing on refresh
                window.history.replaceState({}, document.title, window.location.pathname); 

            } else if (authStatus === 'error') {
                statusMessage.textContent = `Connection failed: ${decodeURIComponent(authErrorMessage || 'Unknown error')}`;
                statusMessage.classList.add('text-red-400');
                sessionStorage.setItem('instagramConnected', 'false');
                sessionStorage.removeItem('instagramUsername');
                sessionStorage.removeItem('instagramPosts');
                sessionStorage.removeItem('instagramFollowers');
                sessionStorage.removeItem('instagramFollowing');
                // Clear the URL parameters
                window.history.replaceState({}, document.title, window.location.pathname);
            }

            // Update UI based on current state
            updateInstagramUI(isUserConnected, connectedUsername, userPosts, userFollowers, userFollowing);

            // --- OAUTH FLOW TRIGGER ---
            connectButton.addEventListener('click', () => {
                // IMPORTANT: Replace '1034637958867552' with your actual App ID from Meta Developers
                const appId = '1034637958867552'; 
                // IMPORTANT: Replace 'https://deskill.netlify.app/auth/callback.html' with the exact Redirect URI you added in Meta Developers
                // If testing locally, use 'http://localhost:5500/auth/callback.html' or your local server's address
                const redirectUri = 'https://deskill.netlify.app/auth/callback.html'; 

                // These are the permissions your app is requesting from the user
                const scope = 'pages_show_list,instagram_basic,instagram_content_publish';

                // Construct the full OAuth URL
                const authUrl = `https://www.facebook.com/v18.0/dialog/oauth?client_id=${appId}&redirect_uri=${redirectUri}&scope=${scope}&response_type=code`;

                // Redirect the user to Meta's authorization page
                window.location.href = authUrl;
            });

            // --- Feature Button Click Handlers (to open modal) ---
            featureButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const featureType = button.dataset.feature;
                    let title = '';
                    let instructions = '';
                    let submitText = 'Initiate Automation';
                    let placeholder = '';

                    switch (featureType) {
                        case 'post':
                            title = 'Automated Post Generation';
                            instructions = 'Please provide a detailed prompt for the image/video content you wish to generate and publish on your Instagram feed. Describe the visual style, theme, and any specific elements or text to include.';
                            placeholder = 'Example: "Generate a vibrant image of a futuristic city at sunset with a motivational quote about innovation."';
                            submitText = 'Generate & Publish Post';
                            break;
                        case 'reel':
                            title = 'Dynamic Reel Creation';
                            instructions = 'Describe the concept for your Instagram Reel. Include desired themes, key messages, background music style, and any visual elements or transitions you envision.';
                            placeholder = 'Example: "Create an energetic 15-second reel showcasing product features with dynamic text overlays and upbeat electronic music."';
                            submitText = 'Generate & Upload Reel';
                            break;
                        case 'chat':
                            title = 'Intelligent Chat Response Configuration';
                            instructions = 'Define the rules and common queries for your AI chat replier. Specify keywords, expected responses, and any scenarios where human intervention might be required.';
                            placeholder = 'Example: "Set up an automated response for DMs containing 'price' to redirect to our pricing page, and for 'support' to open a ticket."';
                            submitText = 'Configure & Deploy Chatbot';
                            break;
                        case 'story':
                            title = 'Engaging Story Automation';
                            instructions = 'Outline the content and design for your Instagram Story. Specify images, videos, text overlays, polls, or questions you\'d like to include, along with their purpose.';
                            placeholder = 'Example: "Generate a series of 3 stories promoting a flash sale, with a countdown sticker and a 'Shop Now' link."';
                            submitText = 'Generate & Publish Story';
                            break;
                        case 'insights':
                            title = 'Comprehensive Insights Reporting';
                            instructions = 'Specify the type of Instagram performance report you require. Include desired metrics (e.g., follower growth, engagement rate, reach), timeframes, and preferred reporting format.';
                            placeholder = 'Example: "Generate a weekly report on follower growth and top 3 performing posts from the last 7 days."';
                            submitText = 'Generate Insights Report';
                            break;
                        default:
                            title = 'Initiate Automation Task';
                            instructions = 'Please describe the automation task you wish to perform in detail.';
                            placeholder = 'Example: "Automate a specific task..."';
                            submitText = 'Initiate Automation';
                    }

                    modalTitle.textContent = title;
                    modalInstructions.textContent = instructions;
                    modalIntentTextarea.placeholder = placeholder;
                    modalAutomationTypeInput.value = featureType;
                    modalButtonText.textContent = submitText;
                    modalStatusMessage.textContent = ''; // Clear previous modal status
                    modalSpinner.classList.add('hidden'); // Hide spinner

                    intentModal.classList.add('show'); // Show the modal
                });
            });

            // --- Modal Close Button ---
            modalCloseBtn.addEventListener('click', () => {
                intentModal.classList.remove('show'); // Hide the modal
                modalIntentTextarea.value = ''; // Clear textarea on close
            });

            // --- Close modal when clicking outside content ---
            intentModal.addEventListener('click', (e) => {
                if (e.target === intentModal) {
                    intentModal.classList.remove('show');
                    modalIntentTextarea.value = '';
                }
            });


            // --- Modal Form Submission Logic (to n8n) ---
            modalIntentForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                modalButtonText.textContent = 'Processing...';
                modalSpinner.classList.remove('hidden');
                modalStatusMessage.textContent = ''; // Clear previous status

                const intent = modalIntentTextarea.value;
                const automationType = modalAutomationTypeInput.value;

                if (!intent) {
                    modalStatusMessage.textContent = 'Please describe your intent.';
                    modalStatusMessage.classList.remove('text-emerald-400', 'text-red-400');
                    modalStatusMessage.classList.add('text-yellow-400');
                    modalButtonText.textContent = 'Initiate Automation';
                    modalSpinner.classList.add('hidden');
                    return;
                }

                try {
                    // Replace 'YOUR_N8N_WEBHOOK_URL' with your actual n8n webhook URL
                    const n8nWebhookUrl = 'YOUR_N8N_WEBHOOK_URL'; 
                    
                    const response = await fetch(n8nWebhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            intent: intent,
                            automationType: automationType,
                            instagramAccessToken: sessionStorage.getItem('instagramAccessToken'), // Placeholder
                            instagramBusinessId: sessionStorage.getItem('instagramBusinessId') // Placeholder
                        }),
                    });

                    if (response.ok) {
                        const result = await response.json();
                        modalStatusMessage.textContent = `Automation for "${automationType.replace('-', ' ').toUpperCase()}" initiated! Message: ${result.message || 'Success'}`;
                        modalStatusMessage.classList.remove('text-red-400', 'text-yellow-400');
                        modalStatusMessage.classList.add('text-emerald-400');
                        modalIntentTextarea.value = ''; // Clear textarea
                    } else {
                        const errorData = await response.json();
                        modalStatusMessage.textContent = `Error initiating automation: ${errorData.message || response.statusText}`;
                        modalStatusMessage.classList.remove('text-emerald-400', 'text-yellow-400');
                        modalStatusMessage.classList.add('text-red-400');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    modalStatusMessage.textContent = 'An unexpected error occurred. Please try again.';
                    modalStatusMessage.classList.remove('text-emerald-400', 'text-yellow-400');
                    modalStatusMessage.classList.add('text-red-400');
                } finally {
                    modalButtonText.textContent = 'Initiate Automation';
                    modalSpinner.classList.add('hidden');
                }
            });


            // --- Sign Out Logic ---
            signOutButton.addEventListener('click', (event) => {
                event.preventDefault();
                sessionStorage.removeItem('instagramConnected');
                sessionStorage.removeItem('instagramUsername');
                sessionStorage.removeItem('instagramPosts');
                sessionStorage.removeItem('instagramFollowers');
                sessionStorage.removeItem('instagramFollowing');
                sessionStorage.removeItem('instagramAccessToken'); // Clear any stored tokens
                sessionStorage.removeItem('instagramBusinessId'); // Clear any stored IDs
                window.location.href = 'index.html'; // Redirect to home or sign-in page
            });

        </script>
    </body>
    </html>
