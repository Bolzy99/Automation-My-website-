    <!DOCTYPE html>
    <html lang="en" class="scroll-smooth">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dashboard - SKYNET Automation</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
        <script src="https://unpkg.com/lucide-icons@latest/dist/umd/lucide.js"></script>
        <style>
            body { font-family: 'Inter', sans-serif; background-color: #000000; color: #F3F4F6; }
            .gradient-text { background: linear-gradient(90deg, #38bdf8, #a78bfa, #f472b6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent; }
            .dashboard-card { 
                background-color: rgba(31, 41, 55, 0.3); 
                border: 1px solid rgba(75, 85, 99, 0.5); 
                backdrop-filter: blur(10px); 
                -webkit-backdrop-filter: blur(10px); 
                border-radius: 1rem; /* Consistent rounded corners */
            }
            .form-textarea { background-color: rgba(31, 41, 55, 0.5); border: 1px solid #4b5563; transition: border-color 0.2s; }
            .form-textarea:focus { border-color: #38bdf8; outline: none; box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.4); }
            .spinner { border: 4px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: #38bdf8; width: 24px; height: 24px; animation: spin 1s ease-in-out infinite; }
            @keyframes spin { to { transform: rotate(360deg); } }

            /* New styles for feature buttons/cards */
            .feature-button-card {
                @apply bg-gray-800/40 border border-gray-700 rounded-lg p-6 flex flex-col items-center justify-center text-center cursor-pointer transition-all duration-300;
                box-shadow: 0 0 15px rgba(0,0,0,0.3);
            }
            .feature-button-card:hover {
                @apply border-sky-500 transform scale-105;
                box-shadow: 0 0 25px rgba(56, 189, 248, 0.4);
            }
            .feature-button-card i {
                @apply mb-4 text-sky-400;
            }
            .feature-button-card h3 {
                @apply text-xl font-semibold;
            }
        </style>
    </head>
    <body class="antialiased">

        <!-- === HEADER === -->
        <header class="sticky top-0 z-50 bg-black/80 backdrop-blur-sm border-b border-gray-800">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="text-2xl font-bold tracking-wider"><a href="index.html">SKYNET</a></div>
                    <nav class="hidden md:flex items-center space-x-8">
                        <a href="services.html" class="hover:text-sky-400 transition-colors">Services</a>
                        <a href="process.html" class="hover:text-sky-400 transition-colors">Our Process</a>
                        <a href="contact.html" class="hover:text-sky-400 transition-colors">Contact</a>
                    </nav>
                    <div class="flex items-center space-x-4">
                        <a href="#" id="sign-out-btn" class="text-sm hover:text-red-400 transition-colors">Sign Out</a>
                    </div>
                </div>
            </div>
        </header>

        <main class="py-20">
            <div class="container mx-auto px-6">
                <h1 class="text-4xl md:text-5xl font-bold mb-12">Automation <span class="gradient-text">Dashboard</span></h1>

                <!-- Instagram Automation Card -->
                <div class="dashboard-card max-w-4xl mx-auto rounded-2xl p-8">
                    <div class="flex items-center gap-4 mb-6">
                        <i data-lucide="instagram" class="w-8 h-8 text-pink-400"></i>
                        <h2 class="text-3xl font-bold">Instagram Automation Hub</h2>
                    </div>

                    <!-- STEP 1: User sees this first. They need to connect their account. -->
                    <div id="insta-disconnected">
                        <p class="text-gray-400 mb-6">To get started, connect your Instagram account. This will redirect you to Instagram to securely authorize SKYNET to post on your behalf.</p>
                        <button id="connect-insta-btn" class="w-full flex items-center justify-center gap-3 py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-gradient-to-r from-pink-500 to-orange-500 hover:opacity-90 transition-opacity">
                            <i data-lucide="link"></i>
                            Connect with Instagram
                        </button>
                    </div>

                    <!-- STEP 2: This section is hidden until the user successfully connects their account. -->
                    <div id="insta-connected" class="hidden">
                        <div class="bg-emerald-900/50 border border-emerald-500 text-emerald-300 px-4 py-3 rounded-lg mb-6 flex items-center gap-3">
                            <i data-lucide="check-circle"></i>
                            <span>Instagram Account Connected: <strong id="insta-username"></strong></span>
                        </div>

                        <!-- Instagram Profile Info -->
                        <div class="grid grid-cols-3 gap-4 text-center mb-8">
                            <div class="p-4 dashboard-card">
                                <p class="text-2xl font-bold text-sky-400" id="insta-posts-count">0</p>
                                <p class="text-gray-400 text-sm">Posts</p>
                            </div>
                            <div class="p-4 dashboard-card">
                                <p class="text-2xl font-bold text-purple-400" id="insta-followers-count">0</p>
                                <p class="text-gray-400 text-sm">Followers</p>
                            </div>
                            <div class="p-4 dashboard-card">
                                <p class="text-2xl font-bold text-pink-400" id="insta-following-count">0</p>
                                <p class="text-gray-400 text-sm">Following</p>
                            </div>
                        </div>

                        <p class="text-gray-400 text-center mb-6">Select an automation feature below or describe a custom intent.</p>

                        <!-- Instagram Automation Features -->
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                            <div class="feature-button-card" data-feature="post">
                                <i data-lucide="image" class="w-10 h-10"></i>
                                <h3>Post Upload Bot</h3>
                                <p class="text-gray-400 text-sm mt-2">Generate and upload image/video posts.</p>
                            </div>
                            <div class="feature-button-card" data-feature="reel">
                                <i data-lucide="film" class="w-10 h-10"></i>
                                <h3>Reel Upload Bot</h3>
                                <p class="text-gray-400 text-sm mt-2">Create and upload short video reels.</p>
                            </div>
                            <div class="feature-button-card" data-feature="chat">
                                <i data-lucide="message-square" class="w-10 h-10"></i>
                                <h3>Chat Replier Bot</h3>
                                <p class="text-gray-400 text-sm mt-2">Automate replies to DMs and comments.</p>
                            </div>
                            <!-- Add more features as needed -->
                            <div class="feature-button-card" data-feature="story">
                                <i data-lucide="sparkles" class="w-10 h-10"></i>
                                <h3>Story Creator Bot</h3>
                                <p class="text-gray-400 text-sm mt-2">Generate engaging Instagram stories.</p>
                            </div>
                             <div class="feature-button-card" data-feature="insights">
                                <i data-lucide="bar-chart-2" class="w-10 h-10"></i>
                                <h3>Insights Reporter</h3>
                                <p class="text-gray-400 text-sm mt-2">Get automated performance reports.</p>
                            </div>
                            <div class="feature-button-card" data-feature="custom">
                                <i data-lucide="zap" class="w-10 h-10"></i>
                                <h3>Custom Automation</h3>
                                <p class="text-gray-400 text-sm mt-2">Describe any other automation task.</p>
                            </div>
                        </div>

                        <form id="insta-post-form">
                            <label for="intent" class="block text-sm font-medium text-gray-300 mb-2">Describe your automation intent:</label>
                            <textarea id="intent" name="intent" rows="5" class="form-textarea w-full rounded-md p-3 text-lg" placeholder="e.g., 'Create a motivational post about overcoming challenges with a picture of a mountain at sunrise.'"></textarea>
                            
                            <input type="hidden" id="automation-type" name="automationType" value="post"> <!-- Hidden field for automation type -->

                            <div class="mt-6">
                                <button type="submit" class="w-full flex items-center justify-center gap-3 py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-sky-500 hover:bg-sky-600 transition-colors">
                                    <span id="button-text">Generate & Automate</span>
                                    <div id="loading-spinner" class="spinner hidden"></div>
                                </button>
                            </div>
                        </form>
                        
                        <div id="status-message" class="mt-6 text-center text-lg"></div>
                    </div>
                </div>
            </div>
        </main>

        <script>
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // --- UI Elements ---
            const disconnectedView = document.getElementById('insta-disconnected');
            const connectedView = document.getElementById('insta-connected');
            const connectButton = document.getElementById('connect-insta-btn');
            const postForm = document.getElementById('insta-post-form');
            const statusMessage = document.getElementById('status-message');
            const buttonText = document.getElementById('button-text');
            const spinner = document.getElementById('loading-spinner');
            const instaUsernameSpan = document.getElementById('insta-username');
            const signOutButton = document.getElementById('sign-out-btn');

            // New elements for Instagram profile info
            const instaPostsCount = document.getElementById('insta-posts-count');
            const instaFollowersCount = document.getElementById('insta-followers-count');
            const instaFollowingCount = document.getElementById('insta-following-count');

            // New elements for feature buttons
            const featureButtons = document.querySelectorAll('.feature-button-card');
            const automationTypeInput = document.getElementById('automation-type');


            // --- Function to update UI based on connection status ---
            function updateInstagramUI(isConnected, username = '', posts = 0, followers = 0, following = 0) {
                if (isConnected) {
                    disconnectedView.classList.add('hidden');
                    connectedView.classList.remove('hidden');
                    instaUsernameSpan.textContent = `@${username}`;
                    instaPostsCount.textContent = posts.toLocaleString();
                    instaFollowersCount.textContent = followers.toLocaleString();
                    instaFollowingCount.textContent = following.toLocaleString();
                } else {
                    disconnectedView.classList.remove('hidden');
                    connectedView.classList.add('hidden');
                    instaUsernameSpan.textContent = '';
                    instaPostsCount.textContent = '0';
                    instaFollowersCount.textContent = '0';
                    instaFollowingCount.textContent = '0';
                }
            }

            // --- Check URL parameters on page load ---
            const urlParams = new URLSearchParams(window.location.search);
            const authStatus = urlParams.get('status');
            const authCode = urlParams.get('code');
            const authErrorMessage = urlParams.get('message');

            let isUserConnected = sessionStorage.getItem('instagramConnected') === 'true';
            // Placeholder data for testing. In a real app, this would come from your backend.
            let connectedUsername = sessionStorage.getItem('instagramUsername') || 'bolzy99'; 
            let userPosts = parseInt(sessionStorage.getItem('instagramPosts') || '120');
            let userFollowers = parseInt(sessionStorage.getItem('instagramFollowers') || '5432');
            let userFollowing = parseInt(sessionStorage.getItem('instagramFollowing') || '87');


            if (authStatus === 'success' && authCode) {
                // User just successfully authorized via Meta
                isUserConnected = true;
                // In a real app, you'd fetch the actual username and metrics from your backend after token exchange
                // For now, we'll use a placeholder or the test username/metrics
                connectedUsername = 'bolzy99'; 
                userPosts = 125;
                userFollowers = 5500;
                userFollowing = 90;

                sessionStorage.setItem('instagramConnected', 'true');
                sessionStorage.setItem('instagramUsername', connectedUsername);
                sessionStorage.setItem('instagramPosts', userPosts);
                sessionStorage.setItem('instagramFollowers', userFollowers);
                sessionStorage.setItem('instagramFollowing', userFollowing);

                statusMessage.textContent = 'Instagram connected successfully!';
                statusMessage.classList.add('text-emerald-400');
                // Clear the URL parameters to prevent re-processing on refresh
                window.history.replaceState({}, document.title, window.location.pathname); 

            } else if (authStatus === 'error') {
                statusMessage.textContent = `Connection failed: ${decodeURIComponent(authErrorMessage || 'Unknown error')}`;
                statusMessage.classList.add('text-red-400');
                sessionStorage.setItem('instagramConnected', 'false');
                sessionStorage.removeItem('instagramUsername');
                sessionStorage.removeItem('instagramPosts');
                sessionStorage.removeItem('instagramFollowers');
                sessionStorage.removeItem('instagramFollowing');
                // Clear the URL parameters
                window.history.replaceState({}, document.title, window.location.pathname);
            }

            // Update UI based on current state
            updateInstagramUI(isUserConnected, connectedUsername, userPosts, userFollowers, userFollowing);

            // --- OAUTH FLOW TRIGGER ---
            connectButton.addEventListener('click', () => {
                // IMPORTANT: Replace '1034637958867552' with your actual App ID from Meta Developers
                const appId = '1034637958867552'; 
                // IMPORTANT: Replace 'https://deskill.netlify.app/auth/callback.html' with the exact Redirect URI you added in Meta Developers
                // If testing locally, use 'http://localhost:5500/auth/callback.html' or your local server's address
                const redirectUri = 'https://deskill.netlify.app/auth/callback.html'; 

                // These are the permissions your app is requesting from the user
                const scope = 'pages_show_list,instagram_basic,instagram_content_publish';

                // Construct the full OAuth URL
                const authUrl = `https://www.facebook.com/v18.0/dialog/oauth?client_id=${appId}&redirect_uri=${redirectUri}&scope=${scope}&response_type=code`;

                // Redirect the user to Meta's authorization page
                window.location.href = authUrl;
            });

            // --- Feature Button Click Handlers ---
            featureButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const featureType = button.dataset.feature; // Get the data-feature attribute
                    let placeholderText = '';
                    let submitButtonText = 'Generate & Automate';

                    switch (featureType) {
                        case 'post':
                            placeholderText = 'e.g., "Create a motivational post about overcoming challenges with a picture of a mountain at sunrise."';
                            submitButtonText = 'Generate & Post to Instagram';
                            break;
                        case 'reel':
                            placeholderText = 'e.g., "Generate a short, engaging reel about the benefits of AI automation with upbeat music."';
                            submitButtonText = 'Generate & Upload Reel';
                            break;
                        case 'chat':
                            placeholderText = 'e.g., "Set up an AI chatbot to reply to common FAQs in DMs and comments."';
                            submitButtonText = 'Generate & Deploy Chatbot';
                            break;
                        case 'story':
                            placeholderText = 'e.g., "Create a 15-second story promoting our new service with a call to action."';
                            submitButtonText = 'Generate & Post Story';
                            break;
                        case 'insights':
                            placeholderText = 'e.g., "Generate a weekly report on Instagram post performance and audience growth."';
                            submitButtonText = 'Generate Insights Report';
                            break;
                        case 'custom':
                            placeholderText = 'Describe any custom automation you need (e.g., "Automatically follow back new followers who mention us in their stories").';
                            submitButtonText = 'Generate & Automate Custom Task';
                            break;
                        default:
                            placeholderText = 'Describe your automation intent:';
                            submitButtonText = 'Generate & Automate';
                    }

                    document.getElementById('intent').value = ''; // Clear previous intent
                    document.getElementById('intent').placeholder = placeholderText;
                    buttonText.textContent = submitButtonText;
                    automationTypeInput.value = featureType; // Set the hidden input value
                });
            });


            // --- Instagram Posting Logic ---
            postForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                buttonText.textContent = 'Generating...';
                spinner.classList.remove('hidden');
                statusMessage.textContent = ''; // Clear previous status

                const intent = document.getElementById('intent').value;
                const automationType = automationTypeInput.value; // Get the selected automation type

                if (!intent) {
                    statusMessage.textContent = 'Please describe your automation intent.';
                    statusMessage.classList.remove('text-emerald-400', 'text-red-400');
                    statusMessage.classList.add('text-yellow-400');
                    buttonText.textContent = 'Generate & Automate';
                    spinner.classList.add('hidden');
                    return;
                }

                try {
                    // Simulate API call to n8n workflow for content generation and posting
                    // Replace 'YOUR_N8N_WEBHOOK_URL' with your actual n8n webhook URL
                    const n8nWebhookUrl = 'YOUR_N8N_WEBHOOK_URL'; 
                    // You would also send the user's instagram token/ID from sessionStorage or a more secure backend store
                    const response = await fetch(n8nWebhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            intent: intent,
                            automationType: automationType, // Send the selected automation type
                            instagramAccessToken: sessionStorage.getItem('instagramAccessToken'), // Placeholder
                            instagramBusinessId: sessionStorage.getItem('instagramBusinessId') // Placeholder
                        }),
                    });

                    if (response.ok) {
                        const result = await response.json();
                        statusMessage.textContent = `Automation task "${automationType}" initiated! Message: ${result.message || 'Success'}`;
                        statusMessage.classList.remove('text-red-400', 'text-yellow-400');
                        statusMessage.classList.add('text-emerald-400');
                        document.getElementById('intent').value = ''; // Clear textarea
                    } else {
                        const errorData = await response.json();
                        statusMessage.textContent = `Error initiating automation: ${errorData.message || response.statusText}`;
                        statusMessage.classList.remove('text-emerald-400', 'text-yellow-400');
                        statusMessage.classList.add('text-red-400');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    statusMessage.textContent = 'An unexpected error occurred. Please try again.';
                    statusMessage.classList.remove('text-emerald-400', 'text-yellow-400');
                    statusMessage.classList.add('text-red-400');
                } finally {
                    buttonText.textContent = 'Generate & Automate';
                    spinner.classList.add('hidden');
                }
            });

            // --- Sign Out Logic ---
            signOutButton.addEventListener('click', (event) => {
                event.preventDefault();
                sessionStorage.removeItem('instagramConnected');
                sessionStorage.removeItem('instagramUsername');
                sessionStorage.removeItem('instagramPosts');
                sessionStorage.removeItem('instagramFollowers');
                sessionStorage.removeItem('instagramFollowing');
                sessionStorage.removeItem('instagramAccessToken'); // Clear any stored tokens
                sessionStorage.removeItem('instagramBusinessId'); // Clear any stored IDs
                window.location.href = 'index.html'; // Redirect to home or sign-in page
            });

        </script>
    </body>
    </html>
